{
  "id": "postgres",
  "title": "PostgreSQL",
  "intro": "|\nThe [PostgreSQL](https://www.postgresql.org/docs/current/) cheat sheet provides you with the common PostgreSQL commands and statements.",
  "tags": [
    "DB",
    "RDBMS"
  ],
  "categories": [
    "Database"
  ],
  "background": "bg-[#3d6488]",
  "content": "## Getting Started\n\n### Getting started\n\nSwitch and connect\n\n```shell script\n$ sudo -u postgres psql\n```\n\nList all databases\n\n```shell script\npostgres=# \\l\n```\n\nConnect to the database named postgres\n\n```shell script\npostgres=# \\c postgres\n```\n\nDisconnect\n\n```shell script\npostgres=# \\q\npostgres=# \\!\n```\n\n### psql commands {.col-span-2}\n\n| Option              | Example                                      | Description                    |\n| ------------------- | -------------------------------------------- | :----------------------------- |\n| `[-d] <database>`   | psql -d mydb                                 | Connecting to database         |\n| `-U`                | psql -U john mydb                            | Connecting as a specific user  |\n| `-h` `-p`           | psql -h localhost -p 5432 mydb               | Connecting to a host/port      |\n| `-U` `-h` `-p` `-d` | psql -U admin -h 192.168.1.5 -p 2506 -d mydb | Connect remote PostgreSQL      |\n| `-W`                | psql -W mydb                                 | Force password                 |\n| `-c`                | psql -c '\\c postgres' -c '\\dt'               | Execute a SQL query or command |\n| `-H`                | psql -c \"\\l+\" -H postgres > database.html    | Generate HTML report           |\n| `-l`                | psql -l                                      | List all databases             |\n| `-f`                | psql mydb -f file.sql                        | Execute commands from a file   |\n| `-V`                | psql -V                                      | Print the psql version         |\n\n{.show-header}\n\n### Getting help\n\n| -           | -                              |\n| ----------- | :----------------------------- |\n| `\\h`        | Help on syntax of SQL commands |\n| `\\h` DELETE | DELETE SQL statement syntax    |\n| `\\?`        | List of PostgreSQL command     |\n\nRun in PostgreSQL console\n\n## PostgreSQL Working\n\n### Recon\n\nShow version\n\n```\nSHOW SERVER_VERSION;\n```\n\nShow system status\n\n```sql {.wrap}\n\\conninfo\n```\n\nShow environmental variables\n\n```sql {.wrap}\nSHOW ALL;\n```\n\nList users\n\n```sql {.wrap}\nSELECT rolname FROM pg_roles;\n```\n\nShow current user\n\n```sql {.wrap}\nSELECT current_user;\n```\n\nShow current user's permissions\n\n```\n\\du\n```\n\nShow current database\n\n```sql {.wrap}\nSELECT current_database();\n```\n\nShow all tables in database\n\n```sql {.wrap}\n\\dt\n```\n\nList functions\n\n```sql {.wrap}\n\\df <schema>\n```\n\n### Databases\n\nList databases\n\n```sql {.wrap}\n\\l\n```\n\nConnect to database\n\n```sql {.wrap}\n\\c <database_name>\n```\n\nShow current database\n\n```sql {.wrap}\nSELECT current_database();\n```\n\n[Create database](http://www.postgresql.org/docs/current/static/sql-createdatabase.html)\n\n```sql {.wrap}\nCREATE DATABASE <database_name> WITH OWNER <username>;\n```\n\n[Drop database](http://www.postgresql.org/docs/current/static/sql-dropdatabase.html)\n\n```sql {.wrap}\nDROP DATABASE IF EXISTS <database_name>;\n```\n\n[Rename database](http://www.postgresql.org/docs/current/static/sql-alterdatabase.html)\n\n```sql {.wrap}\nALTER DATABASE <old_name> RENAME TO <new_name>;\n```\n\n### Tables\n\nList tables, in current db\n\n```sql {.wrap}\n\\dt\n\nSELECT table_schema,table_name FROM information_schema.tables ORDER BY table_schema,table_name;\n```\n\nList tables, globally\n\n```sql {.wrap}\n\\dt *.*.\n\nSELECT * FROM pg_catalog.pg_tables\n```\n\nList table schema\n\n```sql {.wrap}\n\\d <table_name>\n\\d+ <table_name>\n\nSELECT column_name, data_type, character_maximum_length\nFROM INFORMATION_SCHEMA.COLUMNS\nWHERE table_name = '<table_name>';\n```\n\n[Create table](http://www.postgresql.org/docs/current/static/sql-createtable.html)\n\n```sql {.wrap}\nCREATE TABLE <table_name>(\n  <column_name> <column_type>,\n  <column_name> <column_type>\n);\n```\n\nCreate table, with an auto-incrementing primary key\n\n```sql {.wrap}\nCREATE TABLE <table_name> (\n  <column_name> SERIAL PRIMARY KEY\n);\n```\n\n[Delete table](http://www.postgresql.org/docs/current/static/sql-droptable.html)\n\n```sql {.wrap}\nDROP TABLE IF EXISTS <table_name> CASCADE;\n```\n\n### Permissions\n\nBecome the postgres user, if you have permission errors\n\n```shell\nsudo su - postgres\npsql\n```\n\n[Grant](http://www.postgresql.org/docs/current/static/sql-grant.html) all permissions on database\n\n```sql {.wrap}\nGRANT ALL PRIVILEGES ON DATABASE <db_name> TO <user_name>;\n```\n\nGrant connection permissions on database\n\n```sql {.wrap}\nGRANT CONNECT ON DATABASE <db_name> TO <user_name>;\n```\n\nGrant permissions on schema\n\n```sql {.wrap}\nGRANT USAGE ON SCHEMA public TO <user_name>;\n```\n\nGrant permissions to functions\n\n```sql {.wrap}\nGRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA public TO <user_name>;\n```\n\nGrant permissions to select, update, insert, delete, on a all tables\n\n```sql {.wrap}\nGRANT SELECT, UPDATE, INSERT ON ALL TABLES IN SCHEMA public TO <user_name>;\n```\n\nGrant permissions, on a table\n\n```sql {.wrap}\nGRANT SELECT, UPDATE, INSERT ON <table_name> TO <user_name>;\n```\n\nGrant permissions, to select, on a table\n\n```sql {.wrap}\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO <user_name>;\n```\n\n### Columns\n\n[Add column](http://www.postgresql.org/docs/current/static/sql-altertable.html)\n\n```sql {.wrap}\nALTER TABLE <table_name> IF EXISTS\nADD <column_name> <data_type> [<constraints>];\n```\n\nUpdate column\n\n```sql {.wrap}\nALTER TABLE <table_name> IF EXISTS\nALTER <column_name> TYPE <data_type> [<constraints>];\n```\n\nDelete column\n\n```sql {.wrap}\nALTER TABLE <table_name> IF EXISTS\nDROP <column_name>;\n```\n\nUpdate column to be an auto-incrementing primary key\n\n```sql {.wrap}\nALTER TABLE <table_name>\nADD COLUMN <column_name> SERIAL PRIMARY KEY;\n```\n\nInsert into a table, with an auto-incrementing primary key\n\n```sql {.wrap}\nINSERT INTO <table_name>\nVALUES (DEFAULT, <value1>);\n\n\nINSERT INTO <table_name> (<column1_name>,<column2_name>)\nVALUES ( <value1>,<value2> );\n```\n\n### Data\n\n[Select](http://www.postgresql.org/docs/current/static/sql-select.html) all data\n\n```sql {.wrap}\nSELECT * FROM <table_name>;\n```\n\nRead one row of data\n\n```sql {.wrap}\nSELECT * FROM <table_name> LIMIT 1;\n```\n\nSearch for data\n\n```sql {.wrap}\nSELECT * FROM <table_name> WHERE <column_name> = <value>;\n```\n\n[Insert](http://www.postgresql.org/docs/current/static/sql-insert.html) data\n\n```sql {.wrap}\nINSERT INTO <table_name> VALUES( <value_1>, <value_2> );\n```\n\n[Update](http://www.postgresql.org/docs/current/static/sql-update.html) data\n\n```sql {.wrap}\nUPDATE <table_name>\nSET <column_1> = <value_1>, <column_2> = <value_2>\nWHERE <column_1> = <value>;\n```\n\n[Delete](http://www.postgresql.org/docs/current/static/sql-delete.html) all data\n\n```sql {.wrap}\nDELETE FROM <table_name>;\n```\n\nDelete specific data\n\n```sql {.wrap}\nDELETE FROM <table_name>\nWHERE <column_name> = <value>;\n```\n\n### Users\n\nList roles\n\n```sql {.wrap}\nSELECT rolname FROM pg_roles;\n```\n\n[Create user](http://www.postgresql.org/docs/current/static/sql-createuser.html)\n\n```sql {.wrap}\nCREATE USER <user_name> WITH PASSWORD '<password>';\n```\n\n[Drop user](http://www.postgresql.org/docs/current/static/sql-dropuser.html)\n\n```sql {.wrap}\nDROP USER IF EXISTS <user_name>;\n```\n\n[Alter](http://www.postgresql.org/docs/current/static/sql-alterrole.html) user password\n\n```sql {.wrap}\nALTER ROLE <user_name> WITH PASSWORD '<password>';\n```\n\n### Schema\n\nList schemas\n\n```sql {.wrap}\n\\dn\n\nSELECT schema_name FROM information_schema.schemata;\n\nSELECT nspname FROM pg_catalog.pg_namespace;\n```\n\n[Create schema](http://www.postgresql.org/docs/current/static/sql-createschema.html)\n\n```sql {.wrap}\nCREATE SCHEMA IF NOT EXISTS <schema_name>;\n```\n\n[Drop schema](http://www.postgresql.org/docs/current/static/sql-dropschema.html)\n\n```sql {.wrap}\nDROP SCHEMA IF EXISTS <schema_name> CASCADE;\n```\n\n### Dates\n\nShow [current date](https://www.postgresql.org/docs/15/functions-datetime.html#FUNCTIONS-DATETIME-CURRENT) YYYY-MM-DD\n\n```sql {.wrap}\nSELECT current_date;\n```\n\nCalculate\n[age](<https://www.postgresql.org/docs/15/functions-datetime.html#:~:text=age%20(%20timestamp%2C%20timestamp%20)%20%E2%86%92%20interval>)\nbetween two dates\n\n```sql {.wrap}\nSELECT age(timestamp, timestamp);\n```\n\nShow [current time](https://www.postgresql.org/docs/15/functions-datetime.html#FUNCTIONS-DATETIME-CURRENT) with time\nzone\n\n```sql {.wrap}\nSELECT current_time;\n```\n\n[Make](<https://www.postgresql.org/docs/15/functions-datetime.html#:~:text=make_date%20(%20year%20int%2C%20month%20int%2C%20day%20int%20)%20%E2%86%92%20date>)\ndates using integers\n\n```sql {.wrap}\nSELECT make_date(2021,03,25);\n```\n\n## PostgreSQL Commands\n\n### Tables\n\n| -                | -                               |\n| ---------------- | :------------------------------ |\n| `\\d <table>`     | Describe table                  |\n| `\\d+ <table>`    | Describe table with details     |\n| `\\dt`            | List tables from current schema |\n| `\\dt *.*`        | List tables from all schemas    |\n| `\\dt <schema>.*` | List tables for a schema        |\n| `\\dp`            | List table access privileges    |\n| `\\det[+]`        | List foreign tables             |\n\n### Query buffer\n\n| -            | -                                  |\n| ------------ | :--------------------------------- |\n| `\\e [FILE]`  | Edit the query buffer (or file)    |\n| `\\ef [FUNC]` | Edit function definition           |\n| `\\p`         | Show the contents                  |\n| `\\r`         | Reset (clear) the query buffer     |\n| `\\s [FILE]`  | Display history or save it to file |\n| `\\w FILE`    | Write query buffer to file         |\n\n### Informational {.row-span-4}\n\n| -               | -                               |\n| --------------- | :------------------------------ |\n| `\\l[+]`         | List all databases              |\n| `\\dn[S+]`       | List schemas                    |\n| `\\di[S+]`       | List indexes                    |\n| `\\du[+]`        | List roles                      |\n| `\\ds[S+]`       | List sequences                  |\n| `\\df[antw][S+]` | List functions                  |\n| `\\deu[+]`       | List user mappings              |\n| `\\dv[S+]`       | List views                      |\n| `\\dl`           | List large objects              |\n| `\\dT[S+]`       | List data types                 |\n| `\\da[S]`        | List aggregates                 |\n| `\\db[+]`        | List tablespaces                |\n| `\\dc[S+]`       | List conversions                |\n| `\\dC[+]`        | List casts                      |\n| `\\ddp`          | List default privileges         |\n| `\\dd[S]`        | Show object descriptions        |\n| `\\dD[S+]`       | List domains                    |\n| `\\des[+]`       | List foreign servers            |\n| `\\dew[+]`       | List foreign-data wrappers      |\n| `\\dF[+]`        | List text search configurations |\n| `\\dFd[+]`       | List text search dictionaries   |\n| `\\dFp[+]`       | List text search parsers        |\n| `\\dFt[+]`       | List text search templates      |\n| `\\dL[S+]`       | List procedural languages       |\n| `\\do[S]`        | List operators                  |\n| `\\dO[S+]`       | List collations                 |\n| `\\drds`         | List per-database role settings |\n| `\\dx[+]`        | List extensions                 |\n\n`S`: show system objects, `+`: additional detail\n\n### Connection\n\n| -                      | -                           |\n| ---------------------- | :-------------------------- |\n| `\\c [DBNAME]`          | Connect to new database     |\n| `\\encoding [ENCODING]` | Show or set client encoding |\n| `\\password [USER]`     | Change the password         |\n| `\\conninfo`            | Display information         |\n\n### Formatting\n\n| -                         | -                                          |\n| ------------------------- | :----------------------------------------- |\n| `\\a`                      | Toggle between unaligned and aligned       |\n| `\\C [STRING]`             | Set table title, or unset if none          |\n| `\\f [STRING]`             | Show or set field separator for unaligned  |\n| `\\H`                      | Toggle HTML output mode                    |\n| <code>\\t [on\\|off]</code> | Show only rows                             |\n| `\\T [STRING]`             | Set or unset HTML \\<table\\> tag attributes |\n| <code>\\x [on\\|off]</code> | Toggle expanded output                     |\n\n### Input/Output\n\n| -                 | -                                                              |\n| ----------------- | :------------------------------------------------------------- |\n| `\\copy ...`       | Import/export table<br> _See also:_ [copy](#import-export-csv) |\n| `\\echo [STRING]`  | Print string                                                   |\n| `\\i FILE`         | Execute file                                                   |\n| `\\o [FILE]`       | Export all results to file                                     |\n| `\\qecho [STRING]` | String to output stream                                        |\n\n### Variables\n\n| -                     | -                                             |\n| --------------------- | :-------------------------------------------- |\n| `\\prompt [TEXT] NAME` | Set variable                                  |\n| `\\set [NAME [VALUE]]` | Set variable _(or list all if no parameters)_ |\n| `\\unset NAME`         | Delete variable                               |\n\n### Misc\n\n| -                              | -                    |\n| ------------------------------ | :------------------- |\n| `\\cd [DIR]`                    | Change the directory |\n| <code>\\timing [on\\|off]</code> | Toggle timing        |\n| `\\! [COMMAND]`                 | Execute in shell     |\n| `\\! ls -l`                     | List all in shell    |\n\n### Large Objects\n\n- `\\lo_export LOBOID FILE`\n- `\\lo_import FILE [COMMENT]`\n- `\\lo_list`\n- `\\lo_unlink LOBOID`\n\n{.marker-none}\n\n## Miscellaneous\n\n### Backup\n\nUse pg_dumpall to backup all databases\n\n```shell script\n$ pg_dumpall -U postgres > all.sql\n```\n\nUse pg_dump to backup a database\n\n```shell script\n$ pg_dump -d mydb -f mydb_backup.sql\n```\n\n| -    | -                                              |\n| ---- | :--------------------------------------------- |\n| `-a` | Dump only the data, not the schema             |\n| `-s` | Dump only the schema, no data                  |\n| `-c` | Drop database before recreating                |\n| `-C` | Create database before restoring               |\n| `-t` | Dump the named table(s) only                   |\n| `-F` | Format (`c`: custom, `d`: directory, `t`: tar) |\n\nUse `pg_dump -?` to get the full list of options\n\n### Restore\n\nRestore a database with psql\n\n```shell script\n$ psql -U user mydb < mydb_backup.sql\n```\n\nRestore a database with pg_restore\n\n```shell script\n$ pg_restore -d mydb mydb_backup.sql -c\n```\n\n| -    | -                                                                            |\n| ---- | :--------------------------------------------------------------------------- |\n| `-U` | Specify a database user                                                      |\n| `-c` | Drop database before recreating                                              |\n| `-C` | Create database before restoring                                             |\n| `-e` | Exit if an error has encountered                                             |\n| `-F` | Format (`c`: custom, `d`: directory, `t`: tar, `p`: plain text sql(default)) |\n\n{.marker-none}\n\nUse `pg_restore -?` to get the full list of options\n\n### Remote access\n\nGet location of postgresql.conf\n\n```shell script\n$ psql -U postgres -c 'SHOW config_file'\n```\n\nAppend to postgresql.conf\n\n```shell script\nlisten_addresses = '*'\n```\n\nAppend to pg_hba.conf (Same location as postgresql.conf)\n\n```shell script\nhost  all  all  0.0.0.0/0  md5\nhost  all  all  ::/0       md5\n```\n\nRestart PostgreSQL server\n\n```shell script\n$ sudo systemctl restart postgresql\n```\n\n### Import/Export CSV\n\nExport table into CSV file\n\n```shell script\n\\copy table TO '<path>' CSV\n\\copy table(col1,col1) TO '<path>' CSV\n\\copy (SELECT...) TO '<path>' CSV\n```\n\nImport CSV file into table\n\n```shell script\n\\copy table FROM '<path>' CSV\n\\copy table(col1,col1) FROM '<path>' CSV\n```\n\nSee also: [Copy](https://www.postgresql.org/docs/current/sql-copy.html)\n\n## Also see\n\n- [Posgres-cheatsheet](https://gist.github.com/apolloclark/ea5466d5929e63043dcf#posgres-cheatsheet) _(gist.github.com)_\n"
}