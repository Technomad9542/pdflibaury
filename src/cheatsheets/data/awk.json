{
  "id": "awk",
  "title": "Awk",
  "intro": "|\nThis is a one page quick reference cheat sheet to the [GNU awk](https://www.gnu.org/software/gawk/manual/gawk.html), which covers commonly used awk expressions and commands.",
  "tags": [
    "bash",
    "text",
    "script"
  ],
  "categories": [
    "Linux Command"
  ],
  "background": "bg-slate-600",
  "content": "## Getting Started\n\n### Have a try\n\n```shell script {.wrap}\n$ awk -F: '{print $1, $NF}' /etc/passwd\n```\n\n---\n\n| -             | -                         |\n| ------------- | ------------------------- |\n| `-F:`         | Colon as a separator      |\n| `{...}`       | Awk program               |\n| `print`       | Prints the current record |\n| `$1`          | First field               |\n| `$NF`         | Last field                |\n| `/etc/passwd` | Input data file           |\n\n{.left-text}\n\n### Awk program\n\n```\nBEGIN          {<initializations>}\n   <pattern 1> {<program actions>}\n   <pattern 2> {<program actions>}\n   ...\nEND            {< final actions >}\n```\n\n#### Example\n\n```\nawk '\n    BEGIN { print \"\\n>>>Start\" }\n    !/(login|shutdown)/ { print NR, $0 }\n    END { print \"<<<END\\n\" }\n' /etc/passwd\n```\n\n### Variables {.row-span-2}\n\n```bash\n          $1      $2/$(NF-1)    $3/$NF\n           ▼          ▼           ▼\n        ┌──────┬──────────────────┬───────┐\n$0/NR ▶ │  ID  │  WEBSITE         │  URI  │\n        ├──────┼──────────────────┼───────┤\n$0/NR ▶ │  1   │  cheatsheets.zip │  awk  │\n        ├──────┼──────────────────┼───────┤\n$0/NR ▶ │  2   │  google.com      │  25   │\n        └──────┴──────────────────┴───────┘\n```\n\n---\n\n```\n# First and last field\nawk -F: '{print $1,$NF}' /etc/passwd\n\n# With line number\nawk -F: '{print NR, $0}' /etc/passwd\n\n# Second last field\nawk -F: '{print $(NF-1)}' /etc/passwd\n\n# Custom string\nawk -F: '{print $1 \"=\" $6}' /etc/passwd\n```\n\nSee: [Variables](#awk-variables)\n\n### Awk program examples {.col-span-2 .row-span-2}\n\n```\nawk 'BEGIN {print \"hello world\"}'        # Prints \"hello world\"\nawk -F: '{print $1}' /etc/passwd         # -F: Specify field separator\n\n# /pattern/ Execute actions only for matched pattern\nawk -F: '/root/ {print $1}' /etc/passwd\n\n# BEGIN block is executed once at the start\nawk -F: 'BEGIN { print \"uid\"} { print $1 }' /etc/passwd\n\n# END block is executed once at the end\nawk -F: '{print $1} END { print \"-done-\"}' /etc/passwd\n```\n\n### Conditions\n\n```\nawk -F: '$3>30 {print $1}' /etc/passwd\n```\n\nSee: [Conditions](#awk-conditions)\n\n### Generate 1000 spaces\n\n```\nawk 'BEGIN{\n    while (a++ < 1000)\n        s=s \" \";\n    print s\n}'\n```\n\nSee: [Loops](#awk-loops)\n\n### Arrays\n\n```\nawk 'BEGIN {\n   fruits[\"mango\"] = \"yellow\";\n   fruits[\"orange\"] = \"orange\"\n   for(fruit in fruits) {\n     print \"The color of \" fruit \" is \" fruits[fruit]\n   }\n}'\n```\n\nSee: [Arrays](#awk-arrays)\n\n### Functions\n\n```\n# => 5\nawk 'BEGIN{print length(\"hello\")}'\n# => HELLO\nawk 'BEGIN{print toupper(\"hello\")}'\n# => hel\nawk 'BEGIN{print substr(\"hello\", 1, 3)}'\n```\n\nSee: [Functions](#awk-functions)\n\n## Awk Variables\n\n### Build-in variables\n\n| -              | -                                                   |\n| -------------- | --------------------------------------------------- |\n| `$0`           | Whole line                                          |\n| `$1, $2...$NF` | First, second… last field                           |\n| `NR`           | `N`umber of `R`ecords                               |\n| `NF`           | `N`umber of `F`ields                                |\n| `OFS`          | `O`utput `F`ield `S`eparator <br> _(default \" \")_   |\n| `FS`           | input `F`ield `S`eparator <br> _(default \" \")_      |\n| `ORS`          | `O`utput `R`ecord `S`eparator <br> _(default \"\\n\")_ |\n| `RS`           | input `R`ecord `S`eparator <br> _(default \"\\n\")_    |\n| `FILENAME`     | Name of the file                                    |\n\n### Expressions\n\n| -                   | -                                  |\n| ------------------- | ---------------------------------- |\n| `$1 == \"root\"`      | First field equals root            |\n| `{print $(NF-1)}`   | Second last field                  |\n| `NR!=1{print $0}`   | From 2nd record                    |\n| `NR > 3`            | From 4th record                    |\n| `NR == 1`           | First record                       |\n| `END{print NR}`     | Total records                      |\n| `BEGIN{print OFMT}` | Output format                      |\n| `{print NR, $0}`    | Line number                        |\n| `{print NR \"\t\" $0}`  | Line number (tab)                  |\n| `{$1 = NR; print}`  | Replace 1st field with line number |\n| `$NF > 4`           | Last field > 4                     |\n| `NR % 2 == 0`       | Even records                       |\n| `NR==10, NR==20`    | Records 10 to 20                   |\n| `BEGIN{print ARGC}` | Total arguments                    |\n| `ORS=NR%5?\",\":\"\\n\"` | Concatenate records                |\n\n### Examples\n\nPrint sum and average\n\n```\nawk -F: '{sum += $3}\n     END { print sum, sum/NR }\n' /etc/passwd\n```\n\nPrinting parameters\n\n```\nawk 'BEGIN {\n    for (i = 1; i < ARGC; i++)\n        print ARGV[i] }' a b c\n```\n\nOutput field separator as a comma\n\n```\nawk 'BEGIN { FS=\":\";OFS=\",\"}\n    {print $1,$2,$3,$4}' /etc/passwd\n```\n\nPosition of match\n\n```\nawk 'BEGIN {\n    if (match(\"One Two Three\", \"Tw\"))\n        print RSTART }'\n```\n\nLength of match\n\n```\nawk 'BEGIN {\n    if (match(\"One Two Three\", \"re\"))\n        print RLENGTH }'\n```\n\n### Environment Variables\n\n| -         | -                                                         |\n| --------- | --------------------------------------------------------- |\n| `ARGC`    | Number or arguments                                       |\n| `ARGV`    | Array of arguments                                        |\n| `FNR`     | `F`ile `N`umber of `R`ecords                              |\n| `OFMT`    | Format for numbers <br> _(default \"%.6g\")_                |\n| `RSTART`  | Location in the string                                    |\n| `RLENGTH` | Length of match                                           |\n| `SUBSEP`  | Multi-dimensional array separator <br> _(default \"\\034\")_ |\n| `ARGIND`  | Argument Index                                            |\n\n### GNU awk only\n\n| -             | -                     |\n| ------------- | --------------------- |\n| `ENVIRON`     | Environment variables |\n| `IGNORECASE`  | Ignore case           |\n| `CONVFMT`     | Conversion format     |\n| `ERRNO`       | System errors         |\n| `FIELDWIDTHS` | Fixed width fields    |\n\n### Defining variable\n\n```\nawk -v var1=\"Hello\" -v var2=\"Wold\" '\n    END {print var1, var2}\n' </dev/null\n```\n\n#### Use shell variables\n\n```\nawk -v varName=\"$PWD\" '\n    END {print varName}' </dev/null\n```\n\n## Awk Operators\n\n### Operators\n\n| -                | -           |\n| ---------------- | ----------- |\n| `{print $1}`     | First field |\n| `$2 == \"foo\"`    | Equals      |\n| `$2 != \"foo\"`    | Not equals  |\n| `\"foo\" in array` | In array    |\n\n#### Regular expression\n\n| -               | -                 |\n| --------------- | ----------------- |\n| `/regex/`       | Line matches      |\n| `!/regex/`      | Line not matches  |\n| `$1 ~ /regex/`  | Field matches     |\n| `$1 !~ /regex/` | Field not matches |\n\n#### More conditions\n\n| -                        | -   |\n| ------------------------ | --- |\n| `($2 <= 4 \\|\\| $3 < 20)` | Or  |\n| `($1 == 4 && $3 < 20)`   | And |\n\n### Operations\n\n#### Arithmetic operations\n\n- `+`\n- `-`\n- `*`\n- `/`\n- `%`\n- `++`\n- `--`\n\n{.cols-3 .marker-none}\n\n#### Shorthand assignments\n\n- `+=`\n- `-=`\n- `*=`\n- `/=`\n- `%=`\n\n{.cols-3 .marker-none}\n\n#### Comparison operators\n\n- `==`\n- `!=`\n- `<`\n- `>`\n- `<=`\n- `>=`\n\n{.cols-3 .marker-none}\n\n### Examples\n\n```\nawk 'BEGIN {\n    if (\"foo\" ~ \"^fo+$\")\n        print \"Fooey!\";\n}'\n```\n\n#### Not match\n\n```\nawk 'BEGIN {\n    if (\"boo\" !~ \"^fo+$\")\n        print \"Boo!\";\n}'\n```\n\n#### if in array\n\n```\nawk 'BEGIN {\n    assoc[\"foo\"] = \"bar\";\n    assoc[\"bar\"] = \"baz\";\n    if (\"foo\" in assoc)\n        print \"Fooey!\";\n}'\n```\n\n## Awk Functions\n\n### Common functions {.col-span-2}\n\n| Function              | Description                                                                     |\n| --------------------- | ------------------------------------------------------------------------------- |\n| `index(s,t)`          | Position in string s where string t occurs, 0 if not found                      |\n| `length(s)`           | Length of string s (or $0 if no arg)                                            |\n| `rand`                | Random number between 0 and 1                                                   |\n| `substr(s,index,len)` | Return len-char substring of s that begins at index (counted from 1)            |\n| `srand`               | Set seed for rand and return previous seed                                      |\n| `int(x)`              | Truncate x to integer value                                                     |\n| `split(s,a,fs)`       | Split string s into array a split by fs, returning length of a                  |\n| `match(s,r)`          | Position in string s where regex r occurs, or 0 if not found                    |\n| `sub(r,t,s)`          | Substitute t for first occurrence of regex r in string s (or $0 if s not given) |\n| `gsub(r,t,s)`         | Substitute t for all occurrences of regex r in string s                         |\n| `system(cmd)`         | Execute cmd and return exit status                                              |\n| `tolower(s)`          | String s to lowercase                                                           |\n| `toupper(s)`          | String s to uppercase                                                           |\n| `getline`             | Set $0 to next input record from current input file.                            |\n\n### User defined function\n\n```\nawk '\n    # Returns minimum number\n    function find_min(num1, num2){\n       if (num1 < num2)\n       return num1\n       return num2\n    }\n    # Returns maximum number\n    function find_max(num1, num2){\n       if (num1 > num2)\n       return num1\n       return num2\n    }\n    # Main function\n    function main(num1, num2){\n       result = find_min(num1, num2)\n       print \"Minimum =\", result\n\n       result = find_max(num1, num2)\n       print \"Maximum =\", result\n    }\n    # Script execution starts here\n    BEGIN {\n       main(10, 60)\n    }\n'\n```\n\n## Awk Arrays\n\n### Array with index\n\n```\nawk 'BEGIN {\n    arr[0] = \"foo\";\n    arr[1] = \"bar\";\n    print(arr[0]); # => foo\n    delete arr[0];\n    print(arr[0]); # => \"\"\n}'\n```\n\n### Array with key\n\n```\nawk 'BEGIN {\n    assoc[\"foo\"] = \"bar\";\n    assoc[\"bar\"] = \"baz\";\n    print(\"baz\" in assoc); # => 0\n    print(\"foo\" in assoc); # => 1\n}'\n```\n\n### Array with split\n\n```\nawk 'BEGIN {\n    split(\"foo:bar:baz\", arr, \":\");\n    for (key in arr)\n        print arr[key];\n}'\n```\n\n### Array with asort\n\n```\nawk 'BEGIN {\n    arr[0] = 3\n    arr[1] = 2\n    arr[2] = 4\n    n = asort(arr)\n    for (i = 1; i <= n ; i++)\n        print(arr[i])\n}'\n```\n\n### Multi-dimensional\n\n```\nawk 'BEGIN {\n    multidim[0,0] = \"foo\";\n    multidim[0,1] = \"bar\";\n    multidim[1,0] = \"baz\";\n    multidim[1,1] = \"boo\";\n}'\n```\n\n### Multi-dimensional iteration\n\n```\nawk 'BEGIN {\n    array[1,2]=3;\n    array[2,3]=5;\n    for (comb in array) {\n        split(comb,sep,SUBSEP);\n        print sep[1], sep[2],\n        array[sep[1],sep[2]]\n    }\n}'\n```\n\n## Awk Conditions\n\n### if-else statement\n\n```\nawk -v count=2 'BEGIN {\n    if (count == 1)\n        print \"Yes\";\n    else\n        print \"Huh?\";\n}'\n```\n\n#### Ternary operator\n\n```\nawk -v count=2 'BEGIN {\n    print (count==1) ? \"Yes\" : \"Huh?\";\n}'\n```\n\n### Exists\n\n```\nawk 'BEGIN {\n    assoc[\"foo\"] = \"bar\";\n    assoc[\"bar\"] = \"baz\";\n    if (\"foo\" in assoc)\n        print \"Fooey!\";\n}'\n```\n\n#### Not exists\n\n```\nawk 'BEGIN {\n    assoc[\"foo\"] = \"bar\";\n    assoc[\"bar\"] = \"baz\";\n    if (\"Huh\" in assoc == 0 )\n        print \"Huh!\";\n}'\n```\n\n### switch\n\n```\nawk -F: '{\n    switch (NR * 2 + 1) {\n        case 3:\n        case \"11\":\n            print NR - 1\n            break\n\n        case /2[[:digit:]]+/:\n            print NR\n\n        default:\n            print NR + 1\n\n        case -1:\n            print NR * -1\n    }\n}' /etc/passwd\n```\n\n## Awk Loops\n\n### for...i\n\n```\nawk 'BEGIN {\n    for (i = 0; i < 10; i++)\n        print \"i=\" i;\n}'\n```\n\n#### Powers of two between 1 and 100\n\n```\nawk 'BEGIN {\n    for (i = 1; i <= 100; i *= 2)\n        print i\n}'\n```\n\n### for...in\n\n```\nawk 'BEGIN {\n    assoc[\"key1\"] = \"val1\"\n    assoc[\"key2\"] = \"val2\"\n    for (key in assoc)\n        print assoc[key];\n}'\n```\n\n#### Arguments\n\n```\nawk 'BEGIN {\n    for (argnum in ARGV)\n        print ARGV[argnum];\n}' a b c\n```\n\n### Examples {.row-span-3}\n\n#### Reverse records\n\n```\nawk -F: '{ x[NR] = $0 }\n    END {\n        for (i = NR; i > 0; i--)\n        print x[i]\n    }\n' /etc/passwd\n```\n\n#### Reverse fields\n\n```\nawk -F: '{\n    for (i = NF; i > 0; i--)\n        printf(\"%s \",$i);\n    print \"\"\n}' /etc/passwd\n```\n\n#### Sum by record\n\n```\nawk -F: '{\n    s=0;\n    for (i = 1; i <= NF; i++)\n        s += $i;\n    print s\n}' /etc/passwd\n```\n\n#### Sum whole file\n\n```\nawk -F: '\n    {for (i = 1; i <= NF; i++)\n        s += $i;\n    };\n    END{print s}\n' /etc/passwd\n```\n\n### while {.row-span-2}\n\n```\nawk 'BEGIN {\n    while (a < 10) {\n        print \"- \" \" concatenation: \" a\n        a++;\n    }\n}'\n```\n\n#### do...while\n\n```\nawk '{\n    i = 1\n    do {\n        print $0\n        i++\n    } while (i <= 5)\n}' /etc/passwd\n```\n\n### Break\n\n```\nawk 'BEGIN {\n    break_num = 5\n    for (i = 0; i < 10; i++) {\n        print i\n        if (i == break_num)\n            break\n    }\n}'\n```\n\n### Continue\n\n```\nawk 'BEGIN {\n    for (x = 0; x <= 10; x++) {\n        if (x == 5 || x == 6)\n            continue\n        printf \"%d \", x\n    }\n    print \"\"\n}'\n```\n\n## Awk Formatted Printing\n\n### Usage\n\n#### Right align\n\n```\nawk 'BEGIN{printf \"|%10s|\\n\", \"hello\"}'\n\n|     hello|\n```\n\n#### Left align\n\n```\nawk 'BEGIN{printf \"|%-10s|\\n\", \"hello\"}'\n\n|hello     |\n```\n\n### Common specifiers\n\n| Character     | Description           |\n| ------------- | --------------------- |\n| `c`           | ASCII character       |\n| `d`           | Decimal integer       |\n| `e`, `E`, `f` | Floating-point format |\n| `o`           | Unsigned octal value  |\n| `s`           | String                |\n| `%`           | Literal %             |\n\n### Space\n\n```\nawk -F: '{\n    printf \"%-10s %s\\n\", $1, $(NF-1)\n}' /etc/passwd | head -n 3\n```\n\nOutputs\n\n```shell script\nroot       /root\nbin        /bin\ndaemon     /sbin\n```\n\n### Header\n\n```\nawk -F: 'BEGIN {\n    printf \"%-10s %s\\n\", \"User\", \"Home\"\n    printf \"%-10s %s\\n\", \"----\",\"----\"}\n    { printf \"%-10s %s\\n\", $1, $(NF-1) }\n' /etc/passwd | head -n 5\n```\n\nOutputs\n\n```\nUser       Home\n----       ----\nroot       /root\nbin        /bin\ndaemon     /sbin\n```\n\n## Miscellaneous\n\n### Regex Metacharacters\n\n- `\\`\n- `^`\n- `$`\n- `.`\n- `[`\n- `]`\n- `|`\n- `(`\n- `)`\n- `*`\n- `+`\n- `?`\n\n{.cols-3 .marker-none}\n\n### Escape Sequences\n\n| -    | -                   |\n| ---- | ------------------- |\n| `\\b` | Backspace           |\n| `\\f` | Form feed           |\n| `\\n` | Newline (line feed) |\n| `\\r` | Carriage return     |\n| `\\t` | Horizontal tab      |\n| `\\v` | Vertical tab        |\n\n### Run script\n\n```shell script\n$ cat demo.awk\n#!/usr/bin/awk -f\nBEGIN { x = 23 }\n      { x += 2 }\nEND   { print x }\n$ awk -f demo.awk /etc/passwd\n69\n```\n\n## Also see\n\n- [The GNU Awk User's Guide](https://www-zeuthen.desy.de/dv/documentation/unixguide/infohtml/gawk/gawk.html)\n  _(www-zeuthen.desy.de)_\n- [AWK cheatsheet](https://gist.github.com/Rafe/3102414) _(gist.github.com)_\n"
}